CXX = clang++
CC = clang
BINDIR = ..
OBJDIR = .obj
TARGET = $(BINDIR)/game

EXTERN_DIR = ../../../Lead-Extern
SHARED_SRC = ../../../Lead-Shared-Source

INCDIR = -I$(EXTERN_DIR)/include \
         -I$(EXTERN_DIR)/include/libpng \
         -I$(EXTERN_DIR)/include/libjpeg-turbo \
         -I$(EXTERN_DIR)/include/boost \
         -I$(SHARED_SRC) \
         -I../../liblua/include \
         -I../../libthecore/include \
         -I../../libgame/include \
         -I/usr/local/include

LIBDIR = -L$(EXTERN_DIR)/lib \
         -L../../libthecore/lib \
         -L../../libpoly \
         -L../../libsql \
         -L../../libgame/lib \
         -L../../liblua/lib \
         -L/usr/local/lib

#CFLAGS = -m32 -g -Wall -O2 -pipe -fexceptions -fno-stack-protector -pthread -D_THREAD_SAFE -DNDEBUG
CFLAGS = -m32 -march=i686 -msse2 -g -O1 -pipe -frtti -fexceptions -pthread -D_THREAD_SAFE -DBOOST_BIND_GLOBAL_PLACEHOLDERS -fno-stack-protector -fno-strict-aliasing

# RE-ORDERED LIBS: Higher level libs first, base libs last
LIBS = $(EXTERN_DIR)/lib/libIL.a \
       $(EXTERN_DIR)/lib/libpng.a \
       $(EXTERN_DIR)/lib/libjpeg-turbo.a \
       $(EXTERN_DIR)/lib/libcryptopp.a \
       ../../liblua/lib/liblua.a \
       ../../liblua/lib/liblualib.a \
       ../../libsql/libsql.a \
       ../../libgame/lib/libgame.a \
       ../../libpoly/libpoly.a \
       $(EXTERN_DIR)/lib/mysqlclient.a \
       /usr/lib32/libssl.a /usr/lib32/libcrypto.a \
       ../../libthecore/lib/libthecore.a \
       -lz -lm -lmd -pthread

CPP_SRCS = $(wildcard *.cpp)
C_SRCS = $(wildcard *.c)
OBJS = $(CPP_SRCS:%.cpp=$(OBJDIR)/%.o) $(C_SRCS:%.c=$(OBJDIR)/%.o)

default: $(TARGET)

$(TARGET): $(OBJS)
	$(CXX) $(CFLAGS) $(LIBDIR) $(OBJS) $(LIBS) -o $(TARGET)

$(OBJDIR)/%.o: %.cpp
	@mkdir -p $(OBJDIR)
	$(CXX) $(CFLAGS) $(INCDIR) -c $< -o $@

$(OBJDIR)/%.o: %.c
	@mkdir -p $(OBJDIR)
	$(CC) $(CFLAGS) $(INCDIR) -c $< -o $@

clean:
	rm -rf $(OBJDIR) $(TARGET)
